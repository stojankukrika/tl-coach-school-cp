<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button text="" icon="chevron-back-outline" default-href="home"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ title() | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="bg_color">
  @if (show()) {
    <ion-item>
      <ion-datetime-button datetime="datetime"></ion-datetime-button>
      <ion-modal [keepContentsMounted]="true">
        <ng-template>
          <ion-datetime
            id="datetime"
            [value]="datetime()"
            (ionChange)="datetime.set($event.detail.value)"
            disabled="true">
          </ion-datetime>
        </ng-template>
      </ion-modal>
    </ion-item>

    <ion-list>
      @if (measurement_type() === 'individual') {
        @if (categories().length > 0) {
          <ion-item>
            <ion-label>{{ 'category' | translate }}</ion-label>
            <ion-select
              [value]="selectedCategory()"
              (ionChange)="updateSelectedCategory($event.detail.value)">
              @for (category of categories(); track category.id) {
                <ion-select-option [value]="category">
                  {{ category.name }}
                </ion-select-option>
              }
            </ion-select>
          </ion-item>
        }

        @if (selectedCategory()) {
          <ion-item>
            <ion-label>{{ 'value' | translate }}</ion-label>
            <ion-select
              [value]="selectedValue()"
              (ionChange)="updateSelectedValue($event.detail.value)">
              @for (value of selectedCategory()!.values_array; track $index) {
                <ion-select-option [value]="value">
                  {{ value }}
                </ion-select-option>
              }
            </ion-select>
          </ion-item>
        }
      } @else {
        @for (category of categories(); track category.id) {
          <ion-item>
            <ion-label>{{ category.name }}</ion-label>
            <ion-select
              [value]="category.value"
              (ionChange)="updateCategoryValue(category.id, $event.detail.value)">
              @for (item of category.values_array; track $index) {
                <ion-select-option [value]="item">{{ item }}</ion-select-option>
              }
            </ion-select>
          </ion-item>
        }
      }

      @if (showKey()) {
        <ion-item>
          <ion-label>{{ ('enter' | translate) + ('measurement' | translate) }}</ion-label>
          <ion-input
            type="text"
            [value]="data().key"
            (ionInput)="updateDataKey($event.detail.value)">
          </ion-input>
        </ion-item>
      }

      <ion-grid>
        <ion-row>
          <ion-col size="9">{{ 'members' | translate }}</ion-col>
          <ion-col>{{ 'enter_value' | translate }}</ion-col>
        </ion-row>
        @for (item of members(); track item.member_id) {
          <ion-row>
            <ion-col size="9">
              <ion-label>
                <p>#{{ item.membership_number }}</p>
                <h3>{{ item.first_name }} {{ item.last_name }}</h3>
                <p>{{ item.birth_date }}</p>
              </ion-label>
            </ion-col>
            <ion-col>
              @if (measurement_type() === 'individual') {
                <ion-input
                  type="number"
                  [value]="item.value"
                  (ionInput)="updateMemberValue(item.member_id, $event.detail.value)"
                  placeholder="0">
                </ion-input>
              } @else {
                <ion-input
                  type="text"
                  [value]="item.value"
                  (ionInput)="updateMemberValue(item.member_id, $event.detail.value)"
                  placeholder="0">
                </ion-input>
              }
            </ion-col>
          </ion-row>
        }
      </ion-grid>
      <ion-item><br></ion-item>
    </ion-list>

    <ion-fab class="animate__animated animate__zoomIn" vertical="bottom" horizontal="end" slot="fixed">
      <ion-fab-button (click)="saveEntry()">
        <ion-icon name="save-outline"></ion-icon>
      </ion-fab-button>
    </ion-fab>

    <ion-toast
      [isOpen]="isToastMeasurementOpen()"
      message="{{'measurement_saved' | translate}}"
      [duration]="5000"
      (didDismiss)="setMeasurementOpen(false)">
    </ion-toast>
  }
</ion-content>
