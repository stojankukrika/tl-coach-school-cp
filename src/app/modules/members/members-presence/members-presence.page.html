<ion-header class="safe-area-top">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button text="" icon="chevron-back-outline" default-href="home"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'history_presence' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="bg_color">
  <ion-item lines="full" class="date-selector">
    <ion-label>{{ 'date' | translate }}</ion-label>
    <ion-datetime
      presentation="month-year"
      [value]="selectedDate()"
      (ionChange)="selectedDate.set($any($event).detail.value); fetchData()">
    </ion-datetime>
  </ion-item>

  <div class="table-scroll-wrapper">
    <ion-grid [fixed]="true" class="custom-presence-grid">
      <ion-row class="header-row">
        <ion-col size="4" class="sticky-col">
          <strong>{{ 'full_name' | translate }}</strong>
        </ion-col>
        @for (training of trainingDays(); track training.id; let i = $index) {
          <ion-col class="ion-text-center day-col">
            <strong>{{ i + 1 }}</strong>
          </ion-col>
        }
      </ion-row>

      <!-- Redovi sa Älanovima -->
      @for (member of members(); track member.member_id) {
        <ion-row class="member-row">
          <ion-col size="4" class="sticky-col name-cell" (click)="memberDetails(member)">
            <div class="status-indicator">
              {{ member.first_name }} {{ member.last_name }}
            </div>
          </ion-col>

          @for (status of member.presence; track $index) {
            <ion-col class="ion-text-center status-col">
              @if (status === 'present') {
                <ion-icon name="add-circle" color="success"></ion-icon>
              } @else if (status === 'not_present') {
                <ion-icon name="remove-circle" color="danger"></ion-icon>
              } @else {
                <ion-icon name="help-circle-outline" color="medium" style="opacity: 0.3;"></ion-icon>
              }
            </ion-col>
          }
        </ion-row>
      }

      <!-- Footer Red: Ukupno prisutnih -->
      <ion-row class="footer-row">
        <ion-col size="4" class="sticky-col">
          <strong>{{ 'total' | translate }}</strong>
        </ion-col>
        @for (training of trainingDays(); track training.id) {
          <ion-col class="ion-text-center total-cell">
            <strong>{{ totalPresences()[training.id] || 0 }}</strong>
          </ion-col>
        }
      </ion-row>
    </ion-grid>
  </div>
</ion-content>
