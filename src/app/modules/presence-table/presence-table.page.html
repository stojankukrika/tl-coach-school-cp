<ion-header class="safe-area-top ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button text="" icon="chevron-back-outline" default-href="home"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'presence' | translate }}</ion-title>
    
    <ion-buttons slot="end">
      <ion-button id="presence-options">
        <ion-icon slot="icon-only" name="ellipsis-vertical-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="bg_color">
  <div *ngIf="isLoading()" class="ion-padding ion-text-center">
    <ion-spinner name="crescent"></ion-spinner>
  </div>

<div class="paper-logbook" *ngIf="!isLoading()">
    <div class="log-row header">
      <div class="col-name"><strong>{{ 'full_name' | translate }}</strong></div>
      <div class="days-container">
        <div class="day-cell header" *ngFor="let t of trainingDays(); let i = index">
          {{ i + 1 }}
        </div>
      </div>
    </div>

    <div class="log-row" *ngFor="let member of members()">
      <ng-container *ngIf="member.status === 'active'">
        <div class="col-name" (click)="navigateTo('member-details', [member.id])">
          {{ member.first_name }} {{ member.last_name }}
        </div>

        <div class="days-container">
          <div 
            *ngFor="let status of member.presence; let i = index" 
            class="day-cell status-box"
            [class.present]="status === 'present'"
            [class.absent]="status === 'not_present'"
            (click)="presence(member, i)">
            <ion-icon *ngIf="status === 'present'" name="checkmark"></ion-icon>
            <ion-icon *ngIf="status === 'not_present'" name="close"></ion-icon>
          </div>
        </div>
      </ng-container>
    </div>
  </div>

  <ion-popover trigger="presence-options" triggerAction="click" #popover>
    <ng-template>
      <ion-content>
        <ion-list lines="none">
          <ion-item button *ngIf="showPayments()" (click)="popover.dismiss(); navigateTo('membership-statuses')">
            <ion-label>{{ 'membership_statuses' | translate }}</ion-label>
          </ion-item>
          <ion-item button (click)="popover.dismiss(); navigateTo('measurements', [maxDate])">
            <ion-label>{{ 'measurement' | translate }}</ion-label>
          </ion-item>
          <ion-item button (click)="popover.dismiss(); navigateTo('members-presence')">
            <ion-label>{{ 'history_presence' | translate }}</ion-label>
          </ion-item>
          <ion-item button *ngFor="let item of trainingDays(); let i = index" 
                    (click)="popover.dismiss(); navigateTo('training-plan', [item.id, i+1])">
            <ion-label>{{ 'training' | translate }} {{ i + 1 }}</ion-label>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-popover>
</ion-content>