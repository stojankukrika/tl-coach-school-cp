<ion-header class="safe-area-top ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button text="" icon="chevron-back-outline" default-href="home"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'presence' | translate }}</ion-title>
    <ion-buttons slot="end">
      <ion-button id="presence-options">
        <ion-icon slot="icon-only" name="ellipsis-vertical-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="bg_color">
  <div *ngIf="isLoading()" class="ion-padding ion-text-center">
    <ion-spinner name="crescent"></ion-spinner>
  </div>

  <div class="table-container" *ngIf="!isLoading()">
    <div class="table-wrapper" #tableWrapper>
      <table class="presence-table">
        <thead>
          <tr>
            <th class="sticky-col">{{ 'full_name' | translate }}</th>
            <th *ngFor="let training of trainingDays(); let i = index">
              {{ i + 1 }}
            </th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let member of members()">
            <tr *ngIf="member.status === 'active'">
              <td class="sticky-col sliding-cell">
                <ion-item-sliding>
                  <ion-item-options side="end">
                    <ion-item-option color="success" (click)="presence(member, 1);"
                      expandable="true">
                      <ion-icon slot="icon-only" name="add-outline"></ion-icon>
                    </ion-item-option>
                  </ion-item-options>

                  <ion-item lines="none" class="member-name-item">
                    <ion-label>{{ member.first_name }} {{ member.last_name }}</ion-label>
                  </ion-item>
                  <ion-item-options side="start">
                    <ion-item-option color="danger" (click)="presence(member, 4);"
                      expandable="true">
                      <ion-icon slot="icon-only" name="remove-outline"></ion-icon>
                    </ion-item-option>
                  </ion-item-options>

                </ion-item-sliding>
              </td>
              <td *ngFor="let status of member.presence" class="status-cell">
                <ion-icon *ngIf="status === 'present'" name="add-outline" color="success" class="status-icon present"></ion-icon>
                <ion-icon *ngIf="status === 'not_present'" name="remove-outline" class="status-icon absent"></ion-icon>
                <ion-icon *ngIf="status === 'none'" color="danger" name="remove-outline" class="status-icon none"></ion-icon>
                <ion-icon *ngIf="status === 'sick'" name="medkit-outline" class="status-icon sick"></ion-icon>
              </td>
            </tr>
          </ng-container>
        </tbody>
        <tfoot>
          <tr>
            <td class="sticky-col"><strong>{{ 'total' | translate }}:</strong></td>
            <td *ngFor="let training of trainingDays()">
              <strong>{{ totalPresences()[training.id] || 0 }}</strong>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <ion-popover trigger="presence-options" triggerAction="click" #popover>
    <ng-template>
      <ion-content>
        <ion-list lines="none">
          <ion-item button *ngIf="showPayments()" (click)="popover.dismiss(); navigateTo('membership-statuses')">
            <ion-label>{{ 'membership_statuses' | translate }}</ion-label>
          </ion-item>
          <ion-item button (click)="popover.dismiss(); navigateTo('measurements', [maxDate])">
            <ion-label>{{ 'measurement' | translate }}</ion-label>
          </ion-item>
          <ion-item button (click)="popover.dismiss(); navigateTo('members-presence')">
            <ion-label>{{ 'history_presence' | translate }}</ion-label>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-popover>
</ion-content>