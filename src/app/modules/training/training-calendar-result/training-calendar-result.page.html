<ion-header class="safe-area-top">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button text="" icon="chevron-back-outline" default-href="home"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ 'training_calendar_results' | translate }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="bg_color">
  @if (show()) {
    <!-- Info kartica treninga -->
    <ion-card class="info-card">
      <ion-card-header>
        <ion-card-title>{{ trainingCalendar()?.title }}</ion-card-title>
        <ion-card-subtitle>
          <ion-icon name="calendar-outline"></ion-icon>
          {{ trainingCalendar()?.from }} - {{ trainingCalendar()?.to }}
        </ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        {{ trainingCalendar()?.content }}
      </ion-card-content>
    </ion-card>

    <!-- Glavna kartica za unos -->
    <ion-card class="main-card">
      <ion-list lines="none">

        @if (measurementType() === 'individual') {
          <div class="selection-container">
            @if (categories().length > 0) {
              <ion-item class="custom-item">
                <ion-label>{{ 'category' | translate }}</ion-label>
                <ion-select
                  [value]="selectedCategory()"
                  (ionChange)="selectedCategory.set($event.detail.value)">
                  @for (cat of categories(); track cat.id) {
                    <ion-select-option [value]="cat">{{ cat.name }}</ion-select-option>
                  }
                </ion-select>
              </ion-item>
            }

            @if (selectedCategory()) {
              <ion-item class="custom-item animate__animated animate__fadeIn">
                <ion-label>{{ 'value' | translate }}</ion-label>
                <ion-select
                  [value]="selectedValue()"
                  (ionChange)="selectedValue.set($event.detail.value); loadResults()">
                  @for (val of selectedCategory().values_array; track val) {
                    <ion-select-option [value]="val">{{ val }}</ion-select-option>
                  }
                </ion-select>
              </ion-item>
            }
          </div>
        }

        @if (showKey()) {
          <ion-item class="custom-item">
            <ion-label position="stacked">{{ ('enter' | translate) + ' ' + ('measurement' | translate) }}</ion-label>
            <ion-input
              type="text"
              [ngModel]="measurementKey()"
              (ngModelChange)="measurementKey.set($event)"
              placeholder="...">
            </ion-input>
          </ion-item>
        }

        <!-- Tabela sa Älanovima -->
        <div class="members-grid-container">
          <ion-grid>
            <ion-row class="grid-header">
              <ion-col size="8">{{ 'members' | translate }}</ion-col>
              <ion-col size="4" class="ion-text-center">{{ 'value' | translate }}</ion-col>
            </ion-row>

            @for (member of members(); track member.member_id) {
              <ion-row class="member-row" [class.is-readonly]="member.read_only">
                <ion-col size="8">
                  <div class="member-info">
                    <span class="m-number">#{{ member.membership_number }}</span>
                    <span class="m-name">{{ member.first_name }} {{ member.last_name }}</span>
                    <span class="m-date">{{ member.birth_date }}</span>
                  </div>
                </ion-col>
                <ion-col size="4">
                  <ion-input
                    class="value-input"
                    type="number"
                    [(ngModel)]="member.value"
                    [readonly]="member.read_only"
                    placeholder="0">
                  </ion-input>
                </ion-col>
              </ion-row>
            }
          </ion-grid>
        </div>
      </ion-list>

      <div class="ion-padding">
        <ion-button expand="block" (click)="saveMarkForMember()" class="save-btn">
          <ion-icon slot="start" name="save-outline"></ion-icon>
          {{ 'save' | translate }}
        </ion-button>
      </div>
    </ion-card>
  } @else {
    <div class="ion-text-center ion-padding">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
  }
</ion-content>
